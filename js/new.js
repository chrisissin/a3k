var msg="「你到此處學藝也已近十年，是該出外歷練一番了，在讓你出關前，為師要再教你幾樣在亂世中必須瞭解的知識，好好聽完。除了對你有很大的幫助之外，師父還會額外給你一些獎勵」 （按「確認」繼續）」";
var msg1="「首先教你如何移動,想移動就必須要到移動的介面,按下畫面上方的移動按鈕」";
var msg2="「後漢的國土廣大,主要分為13州,每洲當中又有不少值得好好探索的地方,記得不要錯過了（按「確認」繼續）」";
var msg3="「地圖左上方會顯示你目前所在的位置，在地圖右方可看到「墨門後山」的選項，現在試著點擊「墨門後山」";
var msg4="「接著在「墨門後山」的下方可以找到「移動」的按鈕，當你選完目的地在按下這個「移動」的按鈕，就能立即移動到選擇的目的地，現在試著點擊「墨門後山」下方的「移動」按鈕 」";
var msg5="「很好,你已經學會如何移動了」"
var msg6="「經驗值+50,得到新手劍」"
var msg7="「現在教你如何裝備物品，按下畫面上方的「物品」按鈕」";
var msg8="「你可以看到自己身上所擁有的物品，依照種類的不同放在不同的頁面，有沒有看到你已經有了一個裝備？點擊該裝備的圖示不但可以選取該樣裝備，還能看到該裝備的詳細資料，現在試著點選看看。」";
var msg9="「可以看到介面右方在你點選物品後就同時顯示出該物品的說明，現在試著裝備這個物品，在物品說明的下方尋找「裝備」按鈕，按下後你就能立即裝備該物品（按下在物品說明下方的「裝備」按鈕）」";
var msg10="「很好，你已經學會如何裝備物品了（按「確認」繼續）」";
var msg11="「經驗值+50,得到物品：新手頭巾一個、武將：墨門小師弟」";
var msg12="「現在你已經裝備了武器，也有了並肩作戰的同伴，該是試試看戰鬥的時候，在畫面右方可看到「戰鬥」的按鈕，只要點下就會立即開始戰鬥，準備好了就立即開始吧！（按下畫面右方的「戰鬥」按鈕）」";
var msg13="「做的好，不愧是我墨門中傑出的弟子，雖然一般的戰鬥難不倒你，但是也別忘了要住宿休息，才能確保在戰鬥前保持最佳狀態。 （按「確認」繼續）」";
var msg14="「經驗值+50,金錢+100」";
var msg15="「現在教你使用戰技，想使用戰技必須先把學會的技能放到快捷鍵，首先按下「狀態」（按下畫面上方的「狀態」按鈕）」";
var msg16="「接著按下介面上方的「戰技」按鈕（按下介面上方的「戰技」按鈕）」";
var msg17="「這裡可以看到所有戰技的資訊，要使用戰技要先選取想要用的戰技（按下介面中戰技的圖示）」";
//var msg18="「你可以自行控制戰技要放到哪一個快捷鍵上，現在按下「快捷」按鈕左方的下拉式選單（按下「快捷」按鈕左方的下拉式選單）」";
//var msg19="「接下來選擇「7」（按下下拉式選單中的「7」）」";
var msg20="「接下來點擊「快捷」（按下「快捷」）」";
var msg21="「你已經成功的把戰技放到快捷鍵（按「確認」繼續）」";
var msg215="「你還是可以自行控制戰技要放在哪一個快捷鍵上，只要按下「快捷」按鈕左方的下拉式選單，選好號碼之後再按下「快捷」就可以了。（按「確認」繼續）」";
var msg22="「經驗值+50,金錢+100」";
var msg23="「現在為師教你在戰鬥中使用戰技的方式，首先按下戰鬥（按下畫面右方的「戰鬥」按鈕）」";
var msg24="「使用戰技很簡單，只要在戰鬥中按下快捷上得技能圖示，下一回合就能使用，現在試著按下剛剛設定在快捷上的圖示（按下快捷列上的「戰技圖示」）」";
var msg25="「現在你知道如何使用戰技了，別忘了在戰鬥中善用戰技可以讓你戰勝頑強的敵人。（按「確認」繼續）」";
var msg26="「經驗值+50,金錢+100」";
var msg49="「雖然身處亂世，但是各州的主要城市裡還是有不少各行各業的人事在活動，不但可以在此處買賣物品，甚至還會找到一些需要幫忙的人，協助他們不但可以累積自己的聲望，還有可能得到不少的好處，記得每到一個新的城鎮都要花點時間好好逛一下。（按「確認」繼續）」";
var msg50="「在亂世中闖蕩時，常會遇到志同道合的武將願意與你一起並肩作戰，但在你找到其他同伴前，師父決定先派小師弟協助你，同時先教導你選擇出戰武將的方式（按「確認」繼續）」」";
var msg51="「首先點擊畫面上方的「狀態」按鈕（按下畫面上方的「狀態」按鈕）」";
var msg52="「接著按下介面上方的「武將」按鈕（按下介面上方的「武將」按鈕）」";
var msg53="「這裡可以看到所有同伴的資訊，我已經派小師弟到你身邊了，要讓他與你一起作戰，先在小師弟的頭相上點擊一次（按下介面中墨門小師弟的頭相）」";
var msg54="「你可以看到所選取武將的相關資訊與武將全身圖，接下來只要點下武將全身圖下方的「選擇出戰」按鈕，選取的武將就會在戰鬥中與你並肩作戰了，現在試著按下武將全身圖下方的「選擇出戰」按鈕（按下武將全身圖下方的「選擇出戰」按鈕）」";
var msg55="「很好，你已經學會如何選擇武將出戰了（按「確認」繼續）」」";
var msg56="「經驗值+50,得到新手服一件、新手披肩一件」";
var msg57="「師父暫時沒有什麼東西教你了，好好努力不要辜負為師對你的期望，在亂世中重振墨門的聲威（按「確認」繼續）」」";


$(document).ready(function() {
	    $('#skip01').click(function() {
        laststep();
    });
			$('#skip02').click(function() {
        laststep();
    });    
	
    $('#teambtn').click(function() {
        notifyactionresult("未開放");
    });
    $('#guildbtn').click(function() {
        notifyactionresult("未開放");
    });
    $('#eventbtn').click(function() {
        notifyactionresult("未開放");
    });        

    $('#downtownbtn').click(function() {
       notifyactionresult("未開放");
    });
    
    $('#savecash').click(function() {
        $('#savecash').attr('href',Cashaddress);
    });
    
       $("#shortcut_1").unbind('click');
    $('#shortcut_1').bind("click", function() {
        skill_appl(getplayer(), '1');
    });
    $("#shortcut_2").unbind('click');
    $('#shortcut_2').bind("click", function() {
        skill_appl(getplayer(), '2');
    });
    $("#shortcut_3").unbind('click');
    $('#shortcut_3').bind("click", function() {
        skill_appl(getplayer(), '3');
    });
    $("#shortcut_4").unbind('click');
    $('#shortcut_4').bind("click", function() {
        skill_appl(getplayer(), '4');
    });
    $("#shortcut_5").unbind('click');
    $('#shortcut_5').bind("click", function() {
        skill_appl(getplayer(), '5');
    });
    $("#shortcut_6").unbind('click');
    $('#shortcut_6').bind("click", function() {
        skill_appl(getplayer(), '6');
    });
    $("#shortcut_7").unbind('click');
    $('#shortcut_7').bind("click", function() {
        skill_appl(getplayer(), '7');
    });
    $("#shortcut_8").unbind('click');
    $('#shortcut_8').bind("click", function() {
        skill_appl(getplayer(), '8');
    });
    $("#shortcut_9").unbind('click');
    $('#shortcut_9').bind("click", function() {
        skill_appl(getplayer(), '9');
    });
$("# map_btn_fight").unbind('click');

	    $('#logoff').click(function() {
	    		setplayer(null);
	    		seta3klogin();
	    		checkplayernew();
	    });    
    
    loadmaindiv("guide_map.html");
    
    loadingOn();

    $('#refresh').click(function() {
        LoadPlayerInfo(getplayer());
        loadqestionlist(getplayer());
    });
    
	 checkplayernew();
	//test var last = 'laststep();';
	//test  newbieinstruct(msg, last);  the last modify
	//*******************the beginning of newb mission********************************
	 newbieinstruct(msg);

});
// ************ all about index.html ***********// 	 

// ************ all about short cut ***********// 	 

function checkplayernew()
{
	if(getplayer() == null)
	{
		  	  	$.post("./dispatchers/dispatcher.php", { newb : "newb" ,  what: "checkplayer" },
	  	  	 function(data){
	  	  	 	if(data) {
	  	  	 		checkplayernew_res(data); 	  	 		
	  	  	 	}
	  	  	 	},'json'
	  	  				);		
			return false;
	}else
		{
			return true;
		}	
}

function checkplayernew_res(data)
{

	if(data.code == "-999")
	{
		alert(data.msg);
		window.location = "./";
		return;
	}	
	if(data.code == "-666")
	{
		alert(data.msg);
		window.location = loginaddress;
		return;
	}	
	if(data.code == "-777")
	{
		setplayer(data.msg);
		invocapt();
		return;
	}	
	if(data.code == "-1")
	{
		alert(data.msg);
		window.location = loginaddress;
		return;
	}	
	if(data.code == "-2")
	{
		initwin();
		notifyactionresult(data.msg);
		return;
	}
	if(data.msg != "")
	{
		initwin();
		notifyactionresult(data.msg);
		return;
	}		
	setplayer(data.code);
	 $('#apopup').hidePopup();
	$("#apopup").html("");	
	$("#apopup").hide();
	loadintnew();
}

function loadintnew()
{
		
		loadingOff();
    $("#chatdiv").load("/a3k/chat.html");
    $("#maindiv").load("/a3k/guide_map.html");
    
    loadqestionlist(getplayer());
    LoadPlayerInfo(getplayer());
    listshortcut(getplayer());    	

}


function listshortcut(me)
{
		  	  	$.post("./dispatchers/dispatcher.php", {me: ""+me+""  , what: "listshortcut"  },
	  	  	 function(data){ 
	  	  	}, 'json'
	  	  				); 	
}
  
function newbieinstruct(msg)
{	
        if ($('#newepopup').length == 0) {
            $('<div></div>')
	  .attr('id', 'newepopup')
      .css('position', 'absolute')
	  .hide()
	  .popup({
	  	linkSensor:false,
	  	outSensor:false
	  })
      .appendTo('body');
        }
        $('#newepopup').load('./newmessage1.html', {}, function() {
            $(this).showPopup();
            var tool = $('#city_box13');
            var toolPosition = tool.offset();
            moveTo($(this), { x: toolPosition.left + 300, y: toolPosition.top +150});
            	$('#msgbox').html(msg);
            loadingOn();
            $('#surebtn').click(function() {
       							 newbieinstruct1(msg1); //move to next one
     						   $('#newepopup').hidePopup();
     						   loadingOff();
     						        					//	   eval(last);
   						 });
        });
        $("#newepopup").draggable();	
	}

// ************ all about index.html ***********// 	
//----------------Begin Learning how to move--------------------------------------
//首先教你如何移動,想移動就必須要到移動的介面,按下畫面上方的移動按鈕
function newbieinstruct1(msg)
{	
        if ($('#newepopup').length == 0) {
            $('<div></div>')
	  .attr('id', 'newepopup')
      .css('position', 'absolute')
	  .hide()
	  .popup({
	  	linkSensor:false,
	  	outSensor:false
	  })
      .appendTo('body');
        }
        $('#newepopup').load('./newmessage1.html', {}, function() {
            $(this).showPopup();
            var tool = $('#city_box13');
            var toolPosition = tool.offset();
            moveTo($(this), { x: toolPosition.left + 300, y: toolPosition.top +150});
            	$('#msgbox').html(msg);
            loadingOn();
            $('#surebtn').click(function() {
       							 showmovebtn();//*****sparkle move btn**********
     						   $('#newepopup').hidePopup();
     						   loadingOff();
     						        					//	   eval(last);
   						 });
        });
        $("#newepopup").draggable();	
	}
	
//後漢的國土廣大,主要分為13州,每洲當中又有不少值得好好探索的地方,記得不要錯過了
function newbieinstruct2(msg)
{
	$("#moveit").unbind('click');
	loadingOn();
        if ($('#newepopup').length == 0) {
            $('<div></div>')
	  .attr('id', 'newepopup')
      .css('position', 'absolute')
	  .hide()
	  .popup({
	  	linkSensor:false,
	  	outSensor:false
	  })
      .appendTo('body');
        }
        $('#newepopup').load('./newmessage1.html', {}, function() {
            $(this).showPopup();
            var tool = $('#city_box13');
            var toolPosition = tool.offset();
            moveTo($(this), { x: toolPosition.left + 300, y: toolPosition.top +150});
            	$('#msgbox').html(msg);
            loadingOn();
            $("#surebtn").unbind('click');
            $('#surebtn').click(function() {
       							 newbieinstruct3(msg3);//********keep displaying message
     						   $('#newepopup').hidePopup();
     						  loadingOff(); 
   						 });
        });
        $("#newepopup").draggable();	 
	}
//地圖左上方會顯示你目前所在的位置,在地圖右方可看到墨門後山的選項,現在是著點擊墨門後山
	function newbieinstruct3(msg)
{
        if ($('#newepopup').length == 0) {
            $('<div></div>')
	  .attr('id', 'newepopup')
      .css('position', 'absolute')
	  .hide()
	  .popup({
	  	linkSensor:false,
	  	outSensor:false
	  })
      .appendTo('body');
        }
        $('#newepopup').load('./newmessage1.html', {}, function() {
            $(this).showPopup();
            var tool = $('#city_box13');
            var toolPosition = tool.offset();
            moveTo($(this), { x: toolPosition.left + 300, y: toolPosition.top +150});
            	$('#msgbox').html(msg);
            	loadingOn();
            $("#surebtn").unbind('click');
            $('#surebtn').click(function() {
            	
       							 showcitybtn();//*********sparkle city button
     						   $('#newepopup').hidePopup();
     						   	loadingOff();
   						 });
        });
        $("#newepopup").draggable();	   
	}
//接者再墨門後山的下方可以找到移動的按鈕,當你選完目的地再按下這個移動的按鈕,就能立刻移動到選擇的目的地,線再是著點擊墨門後山下方的移動按鈕
	function newbieinstruct4(msg)
{

        if ($('#newepopup').length == 0) {
            $('<div></div>')
	  .attr('id', 'newepopup')
      .css('position', 'absolute')
	  .hide()
	  .popup({
	  	linkSensor:false,
	  	outSensor:false
	  })
      .appendTo('body');
        }
        $('#newepopup').load('./newmessage1.html', {}, function() {
            $(this).showPopup();
            var tool = $('#city_box13');
            var toolPosition = tool.offset();
            moveTo($(this), { x: toolPosition.left + 300, y: toolPosition.top +150});
            	$('#msgbox').html(msg);
            	loadingOn();
            $("#surebtn").unbind('click');
            $('#surebtn').click(function() {
            	
       							 showthemovebtn(); //*********show the move bth in map page
     						   $('#newepopup').hidePopup();
     						   	loadingOff();
   						 });
        });
        $("#newepopup").draggable();	   
	}

//很好,你已經學會如何移動了

	function newbieinstruct5(msg)
{
	
        if ($('#newepopup').length == 0) {
            $('<div></div>')
	  .attr('id', 'newepopup')
      .css('position', 'absolute')
	  .hide()
	  .popup({
	  	linkSensor:false,
	  	outSensor:false
	  })
      .appendTo('body');
        }
        $('#newepopup').load('./newmessage1.html', {}, function() {
            $(this).showPopup();
            var tool = $('#city_box13');
            var toolPosition = tool.offset();
            moveTo($(this), { x: toolPosition.left + 300, y: toolPosition.top +150});
            	$('#msgbox').html(msg);
            loadingOn();
            $("#surebtn").unbind('click');
            $('#surebtn').click(function() {
     						   $('#newepopup').hidePopup();
     						   newbaward(getplayer());//********award 經驗值+50,得到新手劍
     						   loadingOff();
   						 });
        });
        $("#newepopup").draggable();	   
	}
	//經驗值+50,得到新手劍
	// ---------------end learning how to move--------------------------
		function newbieinstruct6(msg)
{
	
        if ($('#newepopup').length == 0) {
            $('<div></div>')
	  .attr('id', 'newepopup')
      .css('position', 'absolute')
	  .hide()
	  .popup({
	  	linkSensor:false,
	  	outSensor:false
	  })
      .appendTo('body');
        }
        $('#newepopup').load('./newmessage1.html', {}, function() {
            $(this).showPopup();
            var tool = $('#city_box13');
            var toolPosition = tool.offset();
            moveTo($(this), { x: toolPosition.left + 300, y: toolPosition.top +150});
            	$('#msgbox').html(msg);
            loadingOn();
            $("#surebtn").unbind('click');
            $('#surebtn').click(function() {
            				newbieinstruct7(msg7)
     						   $('#newepopup').hidePopup();
     						   loadingOff();
   						 });
        });
        $("#newepopup").draggable();	   
	}
	
//現在教你如何裝備物品，按下畫面上方的「物品」按鈕
//----------------Begin learning how to equip-----------------------
function newbieinstruct7(msg)
{
	
        if ($('#newepopup').length == 0) {
            $('<div></div>')
	  .attr('id', 'newepopup')
      .css('position', 'absolute')
	  .hide()
	  .popup({
	  	linkSensor:false,
	  	outSensor:false
	  })
      .appendTo('body');
        }
        $('#newepopup').load('./newmessage1.html', {}, function() {
            $(this).showPopup();
            var tool = $('#city_box13');
            var toolPosition = tool.offset();
            moveTo($(this), { x: toolPosition.left + 300, y: toolPosition.top +150});
            	$('#msgbox').html(msg);
            loadingOn();
            $("#surebtn").unbind('click');
            $('#surebtn').click(function() {
     						   $('#newepopup').hidePopup();
     						   showbagbtn();//*********sparkle bag btn
     						   loadingOff();
   						 });
        });
        $("#newepopup").draggable();	   
	}
//你可以看到自己身上所擁有的物品，依照種類的不同放在不同的頁面，有沒有看到你已經有了一個裝備？點擊該裝備的圖示不但可以選取該樣裝備，還能看到該裝備的詳細資料，現在試著點選看看。
//disable surebtn
// go to bag2.js
function newbieinstruct8(msg)
{
	
        if ($('#newepopup').length == 0) {
            $('<div></div>')
	  .attr('id', 'newepopup')
      .css('position', 'absolute')
	  .hide()
	  .popup({
	  	linkSensor:false,
	  	outSensor:false
	  })
      .appendTo('body');
        }
        $('#newepopup').load('./newmessage1.html', {}, function() {
            $(this).showPopup();
            var tool = $('#city_box13');
            var toolPosition = tool.offset();
            moveTo($(this), { x: toolPosition.left + 10, y: toolPosition.top +15});
            	$('#msgbox').html(msg);
            loadingOn();
            $("#surebtn").unbind('click');
            $("#surebtn").hide();
           // $('#surebtn').click(function() {
            	//newbieinstruct9(msg9);
            	//showpackagain();
     						 $('#newepopup').hidePopup();
     					//	   loadingOff();
   						// });
        });
        $("#newepopup").draggable();	   
	}
//可以看到介面右方在你點選物品後就同時顯示出該物品的說明，現在試著裝備這個物品，在物品說明的下方尋找「裝備」按鈕，按下後你就能立即裝備該物品（按下在物品說明下方的「裝備」按鈕）
//disable surebtn
function newbieinstruct9(msg)
{
	
        if ($('#newepopup').length == 0) {
            $('<div></div>')
	  .attr('id', 'newepopup')
      .css('position', 'absolute')
	  .hide()
	  .popup({
	  	linkSensor:false,
	  	outSensor:false
	  })
      .appendTo('body');
        }
        $('#newepopup').load('./newmessage1.html', {}, function() {
            $(this).showPopup();
            var tool = $('#city_box13');
            var toolPosition = tool.offset();
            moveTo($(this), { x: toolPosition.left + 10, y: toolPosition.top +15});
            	$('#msgbox').html(msg);
            loadingOn();
            $("#surebtn").unbind('click');
            $("#surebtn").hide();
        });
        $("#newepopup").draggable();	   
	}
//很好，你已經學會如何裝備物品了（按任意處繼續）
// back from bag2.js
		function newbieinstruct10(msg)
{
        if ($('#newepopup').length == 0) {
            $('<div></div>')
	  .attr('id', 'newepopup')
      .css('position', 'absolute')
	  .hide()
	  .popup({
	  	linkSensor:false,
	  	outSensor:false
	  })
      .appendTo('body');
        }
        $('#newepopup').load('./newmessage1.html', {}, function() {
            $(this).showPopup();
            var tool = $('#city_box13');
            var toolPosition = tool.offset();
            moveTo($(this), { x: toolPosition.left + 10, y: toolPosition.top +15});
            	$('#msgbox').html(msg);
            loadingOn();
            $("#surebtn").unbind('click');
            $('#surebtn').click(function() {
            				newbaward2(getplayer());//award 經驗值+50,得到物品：新手頭巾一個、武將：墨門小師弟
     						   $('#newepopup').hidePopup();
     						   loadingOff();
   						 });
        });
        $("#newepopup").draggable();	   
	}
	//經驗值+50,得到物品：新手頭巾一個、武將：墨門小師弟
//----------------------end learning how to equip--------------------------------
	function newbieinstruct11(msg)
{
		$("#packbtn").unbind('click');
        if ($('#newepopup').length == 0) {
            $('<div></div>')
	  .attr('id', 'newepopup')
      .css('position', 'absolute')
	  .hide()
	  .popup({
	  	linkSensor:false,
	  	outSensor:false
	  })
      .appendTo('body');
        }
        $('#newepopup').load('./newmessage1.html', {}, function() {
            $(this).showPopup();
            var tool = $('#city_box13');
            var toolPosition = tool.offset();
            moveTo($(this), { x: toolPosition.left + 300, y: toolPosition.top +150});
            	$('#msgbox').html(msg);
            loadingOn();
            $("#surebtn").unbind('click');
            $('#surebtn').click(function() {
            	newbieinstruct12(msg12);//*******keep displaying below message
     						   $('#newepopup').hidePopup();
     						   loadingOff();
   						 });
        });
        $("#newepopup").draggable();	   
	}
//現在你已經裝備了武器，該是試試看戰鬥的時候，在畫面右方可看到「戰鬥」的按鈕，只要點下就會立即開始戰鬥，準備好了就立即開始吧！（按下畫面右方的「戰鬥」按鈕）
// --------------------Begin learning how to fight-----------------------------------	
	function newbieinstruct12(msg)
{
	
        if ($('#newepopup').length == 0) {
            $('<div></div>')
	  .attr('id', 'newepopup')
      .css('position', 'absolute')
	  .hide()
	  .popup({
	  	linkSensor:false,
	  	outSensor:false
	  })
      .appendTo('body');
        }
        $('#newepopup').load('./newmessage1.html', {}, function() {
            $(this).showPopup();
            var tool = $('#city_box13');
            var toolPosition = tool.offset();
            moveTo($(this), { x: toolPosition.left + 300, y: toolPosition.top +150});
            	$('#msgbox').html(msg);
            loadingOn();
            $("#surebtn").unbind('click');
            $('#surebtn').click(function() {
            	showfightbtn();//************sparkle fight btn
            	newbfight();//trigger fight event
     						   $('#newepopup').hidePopup();
     						   loadingOff();
   						 });
        });
        $("#newepopup").draggable();	   
	}
//做的好，不虧是我墨門中傑出的第子，雖然一般的戰鬥難不倒你，但是也別忘了要住宿休息，才能確保在戰鬥前保持最佳狀態。(按任意處繼續）
	//triggered when fight end
	function newbieinstruct13(msg)
{
	
        if ($('#newepopup').length == 0) {
            $('<div></div>')
	  .attr('id', 'newepopup')
      .css('position', 'absolute')
	  .hide()
	  .popup({
	  	linkSensor:false,
	  	outSensor:false
	  })
      .appendTo('body');
        }
        $('#newepopup').load('./newmessage1.html', {}, function() {
            $(this).showPopup();
            var tool = $('#city_box13');
            var toolPosition = tool.offset();
            moveTo($(this), { x: toolPosition.left + 300, y: toolPosition.top +150});
            	$('#msgbox').html(msg);
            loadingOn();
            $("#surebtn").unbind('click');
            $('#surebtn').click(function() {
           				 	newbaward3(getplayer());//award 經驗值+50,金錢+100
     						   $('#newepopup').hidePopup();
     						   loadingOff();
   						 });
        });
			$("#newepopup").draggable();	   
	}
//經驗值+50,金錢+100
//----------------------end learning hoe to fight---------------------------------
function newbieinstruct14(msg)
{
	
        if ($('#newepopup').length == 0) {
            $('<div></div>')
	  .attr('id', 'newepopup')
      .css('position', 'absolute')
	  .hide()
	  .popup({
	  	linkSensor:false,
	  	outSensor:false
	  })
      .appendTo('body');
        }
        $('#newepopup').load('./newmessage1.html', {}, function() {
            $(this).showPopup();
            var tool = $('#city_box13');
            var toolPosition = tool.offset();
            moveTo($(this), { x: toolPosition.left + 300, y: toolPosition.top +150});
            	$('#msgbox').html(msg);
            loadingOn();
            $("#surebtn").unbind('click');
            $('#surebtn').click(function() {
            	newbieinstruct15(msg15);//**********move on the next mission(equip skill)
     						   $('#newepopup').hidePopup();
     						   loadingOff();
   						 });
        });
        $("#newepopup").draggable();	   
	}

//現在教你使用戰技，想使用戰技必須先把學會的技能放到快捷鍵，首先按下「狀態」（按下畫面上方的「狀態」按鈕）
//-----------begin learning how to equip skill----------------------------------- 
function newbieinstruct15(msg)
{
	
        if ($('#newepopup').length == 0) {
            $('<div></div>')
	  .attr('id', 'newepopup')
      .css('position', 'absolute')
	  .hide()
	  .popup({
	  	linkSensor:false,
	  	outSensor:false
	  })
      .appendTo('body');
        }
        $('#newepopup').load('./newmessage1.html', {}, function() {
            $(this).showPopup();
            var tool = $('#city_box13');
            var toolPosition = tool.offset();
            moveTo($(this), { x: toolPosition.left + 300, y: toolPosition.top +150});
            	$('#msgbox').html(msg);
            loadingOn();
            $("#surebtn").unbind('click');
            $('#surebtn').click(function() {
     						   $('#newepopup').hidePopup();
     						   showstatusbtn();//******sparkle statue btn
     						   loadingOff();
   						 });
        });
        $("#newepopup").draggable();	   
	}
//接著按下介面上方的「戰技」按鈕（按下介面上方的「戰技」按鈕）	
//disable surebtn
	function newbieinstruct16(msg)
{
        if ($('#newepopup').length == 0) {
            $('<div></div>')
	  .attr('id', 'newepopup')
      .css('position', 'absolute')
	  .hide()
	  .popup({
	  	linkSensor:false,
	  	outSensor:false
	  })
      .appendTo('body');
        }
        $('#newepopup').load('./newmessage1.html', {}, function() {
            $(this).showPopup();
            var tool = $('#city_box13');
            var toolPosition = tool.offset();
            moveTo($(this), { x: toolPosition.left + 10, y: toolPosition.top +15});
            	$('#msgbox').html(msg);
            loadingOn();
            $("#surebtn").unbind('click');
            $("#surebtn").hide();
        });
        $("#newepopup").draggable();	   
	}
//這裡可以看到所有戰技的資訊，要使用戰技要先選取想要用的戰技（按下介面中戰技的圖示）
	function newbieinstruct17(msg)
{
	
        if ($('#newepopup').length == 0) {
            $('<div></div>')
	  .attr('id', 'newepopup')
      .css('position', 'absolute')
	  .hide()
	  .popup({
	  	linkSensor:false,
	  	outSensor:false
	  })
      .appendTo('body');
        }
        $('#newepopup').load('./newmessage1.html', {}, function() {
            $(this).showPopup();
            var tool = $('#city_box13');
            var toolPosition = tool.offset();
            moveTo($(this), { x: toolPosition.left + 10, y: toolPosition.top +15});
            	$('#msgbox').html(msg);
            loadingOn();
            $("#surebtn").unbind('click');
            $("#surebtn").hide();

        });
        $("#newepopup").draggable();	   
	}
//你可以自行控制戰技要放到哪一個快捷鍵上，現在按下「快捷」按鈕左方的下拉式選單（按下「快捷」按鈕左方的下拉式選單）
	function newbieinstruct18(msg)
{
	
        if ($('#newepopup').length == 0) {
            $('<div></div>')
	  .attr('id', 'newepopup')
      .css('position', 'absolute')
	  .hide()
	  .popup({
	  	linkSensor:false,
	  	outSensor:false
	  })
      .appendTo('body');
        }
        $('#newepopup').load('./newmessage1.html', {}, function() {
            $(this).showPopup();
            var tool = $('#city_box13');
            var toolPosition = tool.offset();
            moveTo($(this), { x: toolPosition.left + 10, y: toolPosition.top +15});
            	$('#msgbox').html(msg);
            loadingOn();
            
            $("#surebtn").unbind('click');
            $("#surebtn").hide();
    /*        $('#surebtn').click(function() {
     						   $('#newepopup').hidePopup();
     						   loadingOff();
   						 });*/
        });
        $("#newepopup").draggable();	   
	}
//接下來選擇「7」（按下下拉式選單中的「7」）
//this one will change definitely, because I did not restrict player to choose 7
	function newbieinstruct19(msg)
{
	
        if ($('#newepopup').length == 0) {
            $('<div></div>')
	  .attr('id', 'newepopup')
      .css('position', 'absolute')
	  .hide()
	  .popup({
	  	linkSensor:false,
	  	outSensor:false
	  })
      .appendTo('body');
        }
        $('#newepopup').load('./newmessage1.html', {}, function() {
            $(this).showPopup();
            var tool = $('#city_box13');
            var toolPosition = tool.offset();
            moveTo($(this), { x: toolPosition.left + 10, y: toolPosition.top +15});
            	$('#msgbox').html(msg);
            loadingOn();
            $("#surebtn").unbind('click');
            $("#surebtn").hide();
      //      $('#surebtn').click(function() {
     	//					   $('#newepopup').hidePopup();
     	//					   loadingOff();
   		//				 });
        });
        $("#newepopup").draggable();	   
	}
//接下來點擊「快捷」（按下「快捷」）	
	function newbieinstruct20(msg)
{
	
        if ($('#newepopup').length == 0) {
            $('<div></div>')
	  .attr('id', 'newepopup')
      .css('position', 'absolute')
	  .hide()
	  .popup({
	  	linkSensor:false,
	  	outSensor:false
	  })
      .appendTo('body');
        }
        $('#newepopup').load('./newmessage1.html', {}, function() {
            $(this).showPopup();
            var tool = $('#city_box13');
            var toolPosition = tool.offset();
            moveTo($(this), { x: toolPosition.left + 10, y: toolPosition.top +15});
            	$('#msgbox').html(msg);
            loadingOn();
            showeqskill();
            $("#surebtn").unbind('click');
            $('#surebtn').click(function() {
     						   $('#newepopup').hidePopup();
     						   loadingOff();
   						 });
        });
        $("#newepopup").draggable();	   
	}	
//你已經成功的把戰技放到快捷鍵（按任意處繼續
	function newbieinstruct21(msg)
{
	
        if ($('#newepopup').length == 0) {
            $('<div></div>')
	  .attr('id', 'newepopup')
      .css('position', 'absolute')
	  .hide()
	  .popup({
	  	linkSensor:false,
	  	outSensor:false
	  })
      .appendTo('body');
        }
        $('#newepopup').load('./newmessage1.html', {}, function() {
            $(this).showPopup();
            var tool = $('#city_box13');
            var toolPosition = tool.offset();
            moveTo($(this), { x: toolPosition.left + 10, y: toolPosition.top +15});
            	$('#msgbox').html(msg);
            loadingOn();
            $("#surebtn").unbind('click');
            $('#surebtn').click(function() {
            	newbieinstruct215(msg215);//keep mesage
     						   $('#newepopup').hidePopup();
     						   loadingOff();
   						 });
        });
        $("#newepopup").draggable();	   
	}
	
	function newbieinstruct215(msg)
{
	
        if ($('#newepopup').length == 0) {
            $('<div></div>')
	  .attr('id', 'newepopup')
      .css('position', 'absolute')
	  .hide()
	  .popup({
	  	linkSensor:false,
	  	outSensor:false
	  })
      .appendTo('body');
        }
        $('#newepopup').load('./newmessage1.html', {}, function() {
            $(this).showPopup();
            var tool = $('#city_box13');
            var toolPosition = tool.offset();
            moveTo($(this), { x: toolPosition.left + 10, y: toolPosition.top +15});
            	$('#msgbox').html(msg);
            loadingOn();
            $("#surebtn").unbind('click');
            $('#surebtn').click(function() {
            	newaward4(getplayer());//經驗值+50,金錢+100
     						   $('#newepopup').hidePopup();
     						   loadingOff();
   						 });
        });
        $("#newepopup").draggable();	   
	}	
//經驗值+50,金錢+100
//-------------finish learning hoe to equip skill-------------------------
	function newbieinstruct22(msg)
{

        if ($('#newepopup').length == 0) {
            $('<div></div>')
	  .attr('id', 'newepopup')
      .css('position', 'absolute')
	  .hide()
	  .popup({
	  	linkSensor:false,
	  	outSensor:false
	  })
      .appendTo('body');
        }
        $('#newepopup').load('./newmessage1.html', {}, function() {
            $(this).showPopup();
            var tool = $('#city_box13');
            var toolPosition = tool.offset();
            moveTo($(this), { x: toolPosition.left + 10, y: toolPosition.top +15});
            	$('#msgbox').html(msg);
            loadingOn();
            $("#surebtn").unbind('click');
            $('#surebtn').click(function() {
     						   $('#newepopup').hidePopup();
     						   // x 20090506 missing step 23 (戰鬥/技能)
     						   newbieinstruct49(msg49);
     						   //CAUTION!
     						   //!!!!!!!!!!!it move to fellow equip mission now,"HOWEVER",here should move to mission learning how to fight!!!!
     						   laststep();
     						   loadingOff();

   						 });
        });
        $("#newepopup").draggable();	   
	}
	//---------------------learn how to use skill when fight---------------------------
		function newbieinstruct23(msg)
{

        if ($('#newepopup').length == 0) {
            $('<div></div>')
	  .attr('id', 'newepopup')
      .css('position', 'absolute')
	  .hide()
	  .popup({
	  	linkSensor:false,
	  	outSensor:false
	  })
      .appendTo('body');
        }
        $('#newepopup').load('./newmessage1.html', {}, function() {
            $(this).showPopup();
            var tool = $('#city_box13');
            var toolPosition = tool.offset();
            moveTo($(this), { x: toolPosition.left + 10, y: toolPosition.top +15});
            	$('#msgbox').html(msg);
            loadingOn();
            $("#surebtn").unbind('click');
            $('#surebtn').click(function() {
            			loadmaindiv("guide_map.html");
     						   $('#newepopup').hidePopup();
     						   showfight2();
     						   loadingOff();

   						 });
        });
        $("#newepopup").draggable();	   
	}
	
	function newbieinstruct24(msg)
{

        if ($('#newepopup').length == 0) {
            $('<div></div>')
	  .attr('id', 'newepopup')
      .css('position', 'absolute')
	  .hide()
	  .popup({
	  	linkSensor:false,
	  	outSensor:false
	  })
      .appendTo('body');
        }
        $('#newepopup').load('./newmessage1.html', {}, function() {
            $(this).showPopup();
            var tool = $('#city_box13');
            var toolPosition = tool.offset();
            moveTo($(this), { x: toolPosition.left + 10, y: toolPosition.top +15});
            	$('#msgbox').html(msg);
            loadingOn();
            $("#surebtn").unbind('click');
            $('#surebtn').click(function() {
     						   $('#newepopup').hidePopup();
     						   loadingOff();

   						 });
        });
        $("#newepopup").draggable();	   
	}
	
		function newbieinstruct25(msg)
{

        if ($('#newepopup').length == 0) {
            $('<div></div>')
	  .attr('id', 'newepopup')
      .css('position', 'absolute')
	  .hide()
	  .popup({
	  	linkSensor:false,
	  	outSensor:false
	  })
      .appendTo('body');
        }
        $('#newepopup').load('./newmessage1.html', {}, function() {
            $(this).showPopup();
            var tool = $('#city_box13');
            var toolPosition = tool.offset();
            moveTo($(this), { x: toolPosition.left + 10, y: toolPosition.top +15});
            	$('#msgbox').html(msg);
            loadingOn();
            $("#surebtn").unbind('click');
            $('#surebtn').click(function() {
     						   $('#newepopup').hidePopup();
     						   newbieinstruct26(msg26);
     						   loadingOff();

   						 });
        });
        $("#newepopup").draggable();	   
	}
	
function newbieinstruct26(msg)
{

        if ($('#newepopup').length == 0) {
            $('<div></div>')
	  .attr('id', 'newepopup')
      .css('position', 'absolute')
	  .hide()
	  .popup({
	  	linkSensor:false,
	  	outSensor:false
	  })
      .appendTo('body');
        }
        $('#newepopup').load('./newmessage1.html', {}, function() {
            $(this).showPopup();
            var tool = $('#city_box13');
            var toolPosition = tool.offset();
            moveTo($(this), { x: toolPosition.left + 10, y: toolPosition.top +15});
            	$('#msgbox').html(msg);
            loadingOn();
            $("#surebtn").unbind('click');
            $('#surebtn').click(function() {
     						   $('#newepopup').hidePopup();
     						   newbaward5(getplayer());
     						   loadingOff();

   						 });
        });
        $("#newepopup").draggable();	   
	}
	//--------------------------end learning-----------------------------
	//-------------------this is just a notifation--------------------
	function newbieinstruct49(msg)
{

        if ($('#newepopup').length == 0) {
            $('<div></div>')
	  .attr('id', 'newepopup')
      .css('position', 'absolute')
	  .hide()
	  .popup({
	  	linkSensor:false,
	  	outSensor:false
	  })
      .appendTo('body');
        }
        $('#newepopup').load('./newmessage1.html', {}, function() {
            $(this).showPopup();
            var tool = $('#city_box13');
            var toolPosition = tool.offset();
            moveTo($(this), { x: toolPosition.left + 10, y: toolPosition.top +15});
            	$('#msgbox').html(msg);
            loadingOn();
            $("#surebtn").unbind('click');
            $('#surebtn').click(function() {
            	newbieinstruct50(msg50);//keep displaying message
     						   $('#newepopup').hidePopup();
     						   loadingOff();

   						 });
        });
        $("#newepopup").draggable();	   
	}
	
//在亂世中闖蕩時，常會遇到志同道合的武將願意與你一起並肩作戰，但在你找到其他同伴前，師父決定先派小師弟協助你，同時先教導你選擇出戰武將的方式（按任意處繼續）
//-------------Begin learning how to equip fellow------------------------------
function newbieinstruct50(msg)
{

        if ($('#newepopup').length == 0) {
            $('<div></div>')
	  .attr('id', 'newepopup')
      .css('position', 'absolute')
	  .hide()
	  .popup({
	  	linkSensor:false,
	  	outSensor:false
	  })
      .appendTo('body');
        }
        $('#newepopup').load('./newmessage1.html', {}, function() {
            $(this).showPopup();
            var tool = $('#city_box13');
            var toolPosition = tool.offset();
            moveTo($(this), { x: toolPosition.left + 10, y: toolPosition.top +15});
            	$('#msgbox').html(msg);
            loadingOn();
            $("#surebtn").unbind('click');
            $('#surebtn').click(function() {
            	newbieinstruct51(msg51);//keep displaying message
     						   $('#newepopup').hidePopup();
     						   loadingOff();

   						 });
        });
        $("#newepopup").draggable();	   
	}
	//首先點擊畫面上方的「狀態」按鈕（按下畫面上方的「狀態」按鈕）
		function newbieinstruct51(msg)
{

        if ($('#newepopup').length == 0) {
            $('<div></div>')
	  .attr('id', 'newepopup')
      .css('position', 'absolute')
	  .hide()
	  .popup({
	  	linkSensor:false,
	  	outSensor:false
	  })
      .appendTo('body');
        }
        $('#newepopup').load('./newmessage1.html', {}, function() {
            $(this).showPopup();
            var tool = $('#city_box13');
            var toolPosition = tool.offset();
            moveTo($(this), { x: toolPosition.left + 10, y: toolPosition.top +15});
            	$('#msgbox').html(msg);
            loadingOn();
            $("#surebtn").unbind('click');
            $('#surebtn').click(function() {
            				showstatusbtn2();// sparkle the other status btn
     						   $('#newepopup').hidePopup();
     						   loadingOff();

   						 });
        });
        $("#newepopup").draggable();	   
	}
//接著按下介面上方的「武將」按鈕（按下介面上方的「武將」按鈕）	
//disable surebtn
//move to newfellow_info.js
		function newbieinstruct52(msg)
{
        if ($('#newepopup').length == 0) {
            $('<div></div>')
	  .attr('id', 'newepopup')
      .css('position', 'absolute')
	  .hide()
	  .popup({
	  	linkSensor:false,
	  	outSensor:false
	  })
      .appendTo('body');
        }
        $('#newepopup').load('./newmessage1.html', {}, function() {
            $(this).showPopup();
            var tool = $('#city_box13');
            var toolPosition = tool.offset();
            moveTo($(this), { x: toolPosition.left + 10, y: toolPosition.top +15});
            	$('#msgbox').html(msg);
            loadingOn();
            $("#surebtn").hide();
            $("#surebtn").unbind('click');
           // showfellowbtn();
         /*   $('#surebtn').click(function() {
     						   $('#newepopup').hidePopup();
     						   loadingOff();

   						 });*/
        });
        $("#newepopup").draggable();	   
	}
//這裡可以看到所有同伴的資訊，我已經派小師弟到你身邊了，要讓他與你一起作戰，先在小師弟的頭相上點擊一次（按下介面中墨門小師弟的頭相）	
// back from fellow info.js
//disable surebtn
	function newbieinstruct53(msg)
{

        if ($('#newepopup').length == 0) {
            $('<div></div>')
	  .attr('id', 'newepopup')
      .css('position', 'absolute')
	  .hide()
	  .popup({
	  	linkSensor:false,
	  	outSensor:false
	  })
      .appendTo('body');
        }
        $('#newepopup').load('./newmessage1.html', {}, function() {
            $(this).showPopup();
            var tool = $('#city_box13');
            var toolPosition = tool.offset();
            moveTo($(this), { x: toolPosition.left + 10, y: toolPosition.top +15});
            	$('#msgbox').html(msg);
            loadingOn();
            $("#surebtn").unbind('click');
            $("#surebtn").hide();
            /*$('#surebtn').click(function() {
     						   $('#newepopup').hidePopup();
     						   loadingOff();

   						 });*/
        });
        $("#newepopup").draggable();	   
	}
	//你可以看到所選取武將的相關資訊與武將全身圖，接下來只要點下武將全身圖下方的「選擇出戰」按鈕，選取的武將就會在戰鬥中與你並肩作戰了，現在試著按下武將全身圖下方的「選擇出戰」按鈕（按下武將全身圖下方的「選擇出戰」按鈕）
	//called by fellow_info.js
	//disable surebtn
		function newbieinstruct54(msg)
{

        if ($('#newepopup').length == 0) {
            $('<div></div>')
	  .attr('id', 'newepopup')
      .css('position', 'absolute')
	  .hide()
	  .popup({
	  	linkSensor:false,
	  	outSensor:false
	  })
      .appendTo('body');
        }
        $('#newepopup').load('./newmessage1.html', {}, function() {
            $(this).showPopup();
            var tool = $('#city_box13');
            var toolPosition = tool.offset();
            moveTo($(this), { x: toolPosition.left + 10, y: toolPosition.top +15});
            	$('#msgbox').html(msg);
            loadingOn();
            $("#surebtn").hide();
            $("#surebtn").unbind('click');
      /*    $('#surebtn').click(function() {
     						   $('#newepopup').hidePopup();
     						   loadingOff();

   						 });*/
        });
        $("#newepopup").draggable();	   
	}
//很好，你已經學會如何選擇武將出戰了（按任意處繼續）	
//called in fellow_info.js
		function newbieinstruct55(msg)
{

        if ($('#newepopup').length == 0) {
            $('<div></div>')
	  .attr('id', 'newepopup')
      .css('position', 'absolute')
	  .hide()
	  .popup({
	  	linkSensor:false,
	  	outSensor:false
	  })
      .appendTo('body');
        }
        $('#newepopup').load('./newmessage1.html', {}, function() {
            $(this).showPopup();
            var tool = $('#city_box13');
            var toolPosition = tool.offset();
            moveTo($(this), { x: toolPosition.left + 10, y: toolPosition.top +15});
            	$('#msgbox').html(msg);
            loadingOn();
            $("#surebtn").unbind('click');
            $('#surebtn').click(function() {
            			newbaward4(getplayer());//award 經驗值+50,得到新手服一件、新手披肩一件
     						   $('#newepopup').hidePopup();
     						   loadingOff();

   						 });
        });
        $("#newepopup").draggable();	   
	}
//經驗值+50,得到新手服一件、新手披肩一件
//----------------finish learning how to equip fellow------------------------
	function newbieinstruct56(msg)
{

        if ($('#newepopup').length == 0) {
            $('<div></div>')
	  .attr('id', 'newepopup')
      .css('position', 'absolute')
	  .hide()
	  .popup({
	  	linkSensor:false,
	  	outSensor:false
	  })
      .appendTo('body');
        }
        $('#newepopup').load('./newmessage1.html', {}, function() {
            $(this).showPopup();
            var tool = $('#city_box13');
            var toolPosition = tool.offset();
            moveTo($(this), { x: toolPosition.left + 10, y: toolPosition.top +15});
            	$('#msgbox').html(msg);
            loadingOn();
            $("#surebtn").unbind('click');
            $('#surebtn').click(function() {
            		newbieinstruct57(msg57);//keep displaying message
     						   $('#newepopup').hidePopup();
     						   loadingOff();

   						 });
        });
        $("#newepopup").draggable();	   
	}
//師父暫時沒有什麼東西教你了，好好努力不要辜負為師對你的期望，在亂世中重振墨門的聲威（按任意處繼續）
//*******************the end of newb mission***************************************
	function newbieinstruct57(msg)
{

        if ($('#newepopup').length == 0) {
            $('<div></div>')
	  .attr('id', 'newepopup')
      .css('position', 'absolute')
	  .hide()
	  .popup({
	  	linkSensor:false,
	  	outSensor:false
	  })
      .appendTo('body');
        }
        $('#newepopup').load('./newmessage1.html', {}, function() {
            $(this).showPopup();
            var tool = $('#city_box13');
            var toolPosition = tool.offset();
            moveTo($(this), { x: toolPosition.left + 10, y: toolPosition.top +15});
            	$('#msgbox').html(msg);
            loadingOn();
            $("#surebtn").unbind('click');
            $('#surebtn').click(function() {
     						   $('#newepopup').hidePopup();
     						   laststep();//***********jump to the main page********************
     						   loadingOff();

   						 });
        });
        $("#newepopup").draggable();	   
	}
//sapekle move btn and trigger the link th guide_map.html
function showmovebtn()
{
	$('#moveit').removeClass('btn_top');
	$('#moveit').addClass('guide_btn_top');
	
	$('#moveit').click(function() {
			$('#moveit').removeClass('guide_btn_top');
			$('#moveit').addClass('btn_top');	
      loadmaindiv("guide_map.html");
      newbieinstruct2(msg2);	
    });  
			// showcitybtn();
	}
//sparkle packbtn
function showbagbtn()
{
	$('#packbtn').removeClass('btn_top');
	$('#packbtn').addClass('guide_btn_top');
	
			showpack();
	}
//sparkle statusbtn
function showstatusbtn()
{
	$('#statusbtn').removeClass('btn_top');
	$('#statusbtn').addClass('guide_btn_top');
		goshowstatus();
		
	}
//sparkle the other sparkle btn	
	function showstatusbtn2()
{
	$("#statusbtn").unbind('click');
	$('#statusbtn').removeClass('btn_top');
	$('#statusbtn').addClass('guide_btn_top');
		goshowstatus2();
		
	}
	
/*
function showskillbtn()
{
	$("#skillbtn").unbind('click');
    $('#skillbtn').bind("click", function() {
        $('#popup').load('./newskill_info.html', {}, function() {
        	    	
            $(this).showPopup();
            	$('#skillbtn').removeClass('guide_btn');
							$('#skillbtn').addClass('con_btn');
        });
    });
	}
*/
//valid status btn &show newplayer_info.html(the first item cannot be choosed)
function goshowstatus()
{
	$('#statusbtn').click(function() {
		newbieinstruct16(msg16);
		$('#statusbtn').removeClass('guide_btn_top');
		$('#statusbtn').addClass('btn_top');
    	 loadingOn();
        if ($('#popup').length == 0) {
            $('<div></div>')
		  .attr('id', 'popup')
	      .css('position', 'absolute')
		  .hide()
		  .popup(	{inkSensor:false,
	  	outSensor:false})
	      .appendTo('body');
        }
        $('#popup').load('./newplayer_info.html', {}, function() { // default at player info window
            $(this).showPopup();
            var tool = $('#statusbtn');
            var toolPosition = tool.offset();
            moveTo($(this), { x: toolPosition.left - 2, y: toolPosition.top - 72 });
            loadingOff();
        });
         $("#popup").draggable();
    });
	}
//show newplayer_info2.html
function goshowstatus2()
{
	$('#statusbtn').click(function() {
		newbieinstruct52(msg52);
		$('#statusbtn').removeClass('guide_btn_top');
		$('#statusbtn').addClass('btn_top');
    	 loadingOn();
        if ($('#popup').length == 0) {
            $('<div></div>')
		  .attr('id', 'popup')
	      .css('position', 'absolute')
		  .hide()
		  .popup(	{inkSensor:false,
	  	outSensor:false})
	      .appendTo('body');
        }
        $('#popup').load('./newplayer_info2.html', {}, function() { // default at player info window
            $(this).showPopup();
            var tool = $('#statusbtn');
            var toolPosition = tool.offset();
            moveTo($(this), { x: toolPosition.left - 2, y: toolPosition.top - 72 });
            loadingOff();
        });
         $("#popup").draggable();
    });
	}


function showpack()
{
	 $('#packbtn').click(function() {
    	loadingOn();
        if ($('#popup').length == 0) {
            $('<div></div>')
		  .attr('id', 'popup')
	      .css('position', 'absolute')
		  .hide()
		  .popup(	{inkSensor:false,
	  	outSensor:false})
	      .appendTo('body');
        }
        $('#popup').load('./newbag2.html', {}, function() {
        	$('#loading').hide();
            $(this).showPopup();
            var tool = $('#maindiv');
            var toolPosition = tool.offset();
            moveTo($(this), { x: toolPosition.left -+100, y: toolPosition.top +100 });
            loadingOff();
        });
        $("#popup").draggable();
        $('#packbtn').removeClass('guide_btn_top');
				$('#packbtn').addClass('btn_top');
				newbieinstruct8(msg8);
    });
	}
function showpackagain()
{ 
	loadingOn();
        if ($('#popup').length == 0) {
            $('<div></div>')
		  .attr('id', 'popup')
	      .css('position', 'absolute')
		  .hide()
		  .popup(	{inkSensor:false,
	  	outSensor:false})
	      .appendTo('body');
        }
        $('#popup').load('./newbag2.html', {}, function() {
        	$('#loading').hide();
            $(this).showPopup();
            var tool = $('#maindiv');
            var toolPosition = tool.offset();
            moveTo($(this), { x: toolPosition.left +100, y: toolPosition.top +100 });
            loadingOff();
        });
        $("#popup").draggable();
       
	}

function showcitybtn()
{
	$('#btn_map').addClass('guide_btn_map');
	$('#btn_map').click(function() {
			$('#btn_map').removeClass('guide_btn_map');
			newbieinstruct4(msg4);
	});
}
	
function showthemovebtn()
{ 
	$('#map_btn_move').removeClass('map_btn_move');
	$('#map_btn_move').addClass('guide_btn_move');
	$('#map_btn_move').click(function() {
			$('#map_btn_move').removeClass('guide_btn_move');
			$('#map_btn_move').addClass('map_btn_move');
			movebackyard(getplayer());
	});
}
	
	
function movebackyard(me)
{
	$.post("./dispatchers/dispatcher.php", {me: ""+me+"" ,citi: "x01" ,  what: "moveme2citi" },
	  	  	 function(data){   	
	// $("#nowatstate").html(data); 
	eval(data);
	  	  	 	newbieinstruct5(msg5);},'text'
	  	  				);

}

function showimat(data)
{//debugger;
	$("#nowatciti").html(data.map_city_name);
	$("#nowatstate").html(data.map_state_name);
	document.getElementById('plshit').value = data.map_img;
	//movet2state(data.map_state_name);
}

//經驗值+50,得到新手劍
function newbaward(me)
{
	$.post("./dispatchers/dispatcher.php", {me: ""+me+"" , what: "newbaward" },
	  	  	 function(data){ LoadPlayerInfo(getplayer());  newbieinstruct6(msg6);},'text'
	  	  				);
	}
//經驗值+50,得到物品：新手頭巾一個、武將：墨門小師弟
function newbaward2(me)
{
	$.post("./dispatchers/dispatcher.php", {me: ""+me+"" , what: "newbaward2" },
	  	  	 function(data){ LoadPlayerInfo(getplayer());  newbieinstruct11(msg11);},'text'
	  	  				);
	}
	//經驗值+50,金錢+100	
function newbaward3(me)
{
	$.post("./dispatchers/dispatcher.php", {me: ""+me+"" , what: "newbaward3" },
	  	  	 function(data){ LoadPlayerInfo(getplayer());  newbieinstruct14(msg14);},'text'
	  	  				);
	}
//經驗值+50,得到新手服一件、新手披肩一件
function newbaward4(me)
{
	$.post("./dispatchers/dispatcher.php", {me: ""+me+"" , what: "newbaward4" },
	  	  	 function(data){ LoadPlayerInfo(getplayer());  newbieinstruct56(msg56);},'text'
	  	  				);
	}
//經驗值+50,金錢+100
// call the same function as newbaward3
function newaward4(me)
{
	$.post("./dispatchers/dispatcher.php", {me: ""+me+"" , what: "newbaward3" },
	  	  	 function(data){ LoadPlayerInfo(getplayer());  newbieinstruct22(msg22);},'text'
	  	  				);
	}

function newbaward5(me)
{
	$.post("./dispatchers/dispatcher.php", {me: ""+me+"" , what: "newbaward3" },
	  	  	 function(data){ LoadPlayerInfo(getplayer());  },'text'
	  	  				);
	}

function packshopping()
{
        	$('#chooseitem').removeClass('guide_bag_icon');
					$('#chooseitem').addClass('bag_icontext');
					showequipbtn();
	}
	
	
	function showequipbtn()
	{
		$('#eqptitembtn').removeClass('bag_btn');
		$('#eqptitembtn').addClass('guide_bag_btn');
		}
	
	function showfightbtn()
	{
		$('#New_map_btn_fight').removeClass('map_btn_fight');
		$('#New_map_btn_fight').addClass('guide_btn_fight');
		}
	
		function showfight2()
	{//debugger;
		$('#New_map_btn_fight').removeClass('map_btn_fight');
		$('#New_map_btn_fight').addClass('guide_btn_fight');
		newbfight2();
		}
	
	function newbfight()
	{
		  $('#New_map_btn_fight').click(function()
  {//debugger;
  	$('#New_map_btn_fight').removeClass('guide_btn_fight');
		$('#New_map_btn_fight').addClass('map_btn_fight');
  	loadingOn();
  	fkind = "npc";
  	danpc = 1;
  	loadmaindiv("newfight.html");//go to newfight.html
  	//intoFight();
  });
		}
	
	function newbfight2()
	{
			$('#New_map_btn_fight').click(function()
			{//debugger;
				$('#New_map_btn_fight').removeClass('guide_btn_fight');
				$('#New_map_btn_fight').addClass('map_btn_fight');
 	 			loadingOn();
		  	loadmaindiv("newfight2.html");//go to newfight.html
		  	newbieinstruct24(msg24);
				});
		}
		
function intoFight()
{//debugger;
	loadingOn();
	loadmaindiv("newfight.html");
}

function showeqskill()
{
	$('#toshortcut').removeClass('bag_btn');
	$('#toshortcut').addClass('guide_bag_btn');
	}
	
	function showEqptFellowBtn()
	{
		$('#equipfellowbtn').removeClass('con_btn_pickfight');
		$('#equipfellowbtn').addClass('guide_btn_pickfight');
		}
	
	
	function initshortcutlist()
{
			for(var i =0; i < 9 ; ++i)
			{
				$('#shortcut_img_'+(i+1).toString()).css("background-image","url("+net+"/images/icon.gif)");
				/*$('#shortcut_'+(i+1).toString()).attr({ 
		          src: "/a3k/images/icon.gif",
		          title: "",
		          alt: ""
		        });		*/  		
			}	
}

function listshortcut(me)
{
		  	  	$.post("./dispatchers/dispatcher.php", {me: ""+me+""  , what: "listshortcut"  },
	  	  	 function(data){ 
	  	  	 	initshortcutlist();
	  	  	 	listshortcut_res(data);}, 'json'
	  	  				); 	
}

function listshortcut_res(data)
{
		if(data){
			if(data.length){
			for(var i =0; i < data.length ; ++i)
			{
				$('#shortcut_img_'+data[i].sc_pos).css("background-image","url("+net+"/images_ico/"+data[i].sc_img+".gif)");
			/*	$('#shortcut_'+data[i].sc_pos).attr({ 
		          src: "/a3k/images_ico/"+data[i].sc_img+".gif",
		          title: data[i].sc_usename,
		          alt: data[i].sc_usename
		        });				*/
			}
		}
	}
}

function skill_appl(me, blk)
{
			if(g_infight != 0  ) 	// -- to control short cut use only in fight
			{
		  	  	$.post("./dispatchers/dispatcher.php", {me: ""+me+"" , blk: ""+blk+"" , what: "clickonshortcut"  },
	  	  	 function(data){  skill_appl_res(data);}, 'json'
	  	  				); 	
	  	}else
	  	{
	  		msgonchatboard('快捷只能在戰鬥中使用');
	  	}
}

function skill_appl_res(data)
{//debugger;
	if(data === 1)
	{
			msgonchatboard('使用');
	}else if (data=== -2)
	{
		msgonchatboard('已經使用');
	}else if (data=== -3)
	{
		msgonchatboard('快捷錯誤');
	}else
		{
			msgonchatboard(' -- system error');
		}
}

function laststep()
{
	$.post("./dispatchers/dispatcher.php", {me: getplayer() , what: "gohome" },
	  	  	 function(data){},'text'
	  	  				);
	window.location = "./";
}

// ************ all about short cut ***********// 	 


  


function initwin()
{
	setplayer(null);
				loadingOn();
	         if ($('#apopup').length == 0) {
	            $('<div></div>')
			  .attr('id', 'apopup')
		      .css('position', 'absolute')
			  .hide()
			  .popup(	  	
			  {inkSensor:false,
	  		outSensor:false})
		      .appendTo('body');
	        }
	        $('#apopup').load('./create_2.html', {}, function() { 
	            $(this).showPopup();
	            var tool = $('#maindiv');
	            var toolPosition = tool.offset();
	            moveTo($(this), { x: toolPosition.left + 92, y: toolPosition.top + 72 });
	        });
	         $("#apopup").draggable();				
}


// ************ all about index.html ***********// 	


